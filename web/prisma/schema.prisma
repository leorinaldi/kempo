generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ ENUMS ============

enum VideoType {
  movie
  trailer
  commercial
  tvShow
  online
}

enum VideoRole {
  actor
  director
  writer
  producer
}

// ============ AUDIO & VIDEO MEDIA ============

model Audio {
  id          String    @id @default(cuid())
  name        String
  url         String    @db.Text
  type        String    @default("song")   // "song", "radio_ad", "podcast", etc.
  description String?   @db.Text
  duration    Float?                       // Duration in seconds (auto-detected at upload)
  kyDate      DateTime? @map("ky_date")    // Kempo world date (e.g., 1948-12-25 in k.y.)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  elements      AudioElement[]

  @@map("audio")
}

model Album {
  id          String        @id @default(cuid())
  name        String
  artistId    String?       @map("artist_id")  // Primary artist (Person)
  artist      Person?       @relation(fields: [artistId], references: [id], onDelete: SetNull)
  labelId     String?       @map("label_id")   // Record label (Organization)
  label       Organization? @relation(fields: [labelId], references: [id], onDelete: SetNull)
  kyDate      DateTime?     @map("ky_date")    // Release date in k.y.
  articleId   String?       @unique @map("article_id")
  article     Article?      @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  @@map("albums")
}

model AudioElement {
  id        String   @id @default(cuid())
  audioId   String   @map("audio_id")
  audio     Audio    @relation(fields: [audioId], references: [id], onDelete: Cascade)
  itemId    String   @map("item_id")    // ID of the person, album, etc.
  itemType  String   @map("item_type")  // "singer", "album", "composer", "lyricist", "producer", "speaker"
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([audioId, itemId, itemType])
  @@index([itemId, itemType])
  @@map("audio_elements")
}

model Video {
  id          String    @id @default(cuid())
  name        String
  url         String?   @db.Text             // Nullable for metadata-only entries
  type        VideoType @default(online)     // movie, trailer, commercial, tvShow, online
  description String?   @db.Text
  duration    Float?                         // Duration in seconds (auto-detected at upload)
  width       Int?                           // Pixel width (auto-detected)
  height      Int?                           // Pixel height (auto-detected)
  aspectRatio String?   @map("aspect_ratio") // "landscape" | "portrait" | "square"
  kyDate      DateTime? @map("ky_date")      // Kempo world date (e.g., 1948-12-25 in k.y.)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  genres             VideoGenre[]
  elements           VideoElement[]
  movieMetadata      MovieMetadata?
  tvEpisodeMetadata  TvEpisodeMetadata?
  trailerMetadata    TrailerMetadata?
  commercialMetadata CommercialMetadata?
  onlineMetadata     OnlineMetadata?
  trailersFor        TrailerMetadata[]   @relation("TrailerForMovie")

  // Platform relations
  kempoTubeVideo     KempoTubeVideo?
  flipFlopVideo      FlipFlopVideo?
  tvBroadcasts       TvBroadcast[]

  @@map("video")
}

model Image {
  id          String    @id @default(cuid())
  name        String                         // e.g. "Clay Marshall portrait"
  url         String    @db.Text             // Vercel Blob URL
  description String?   @db.Text             // Caption
  altText     String?   @map("alt_text")     // Accessibility text
  width       Int?                           // Pixel width (auto-detected)
  height      Int?                           // Pixel height (auto-detected)
  shape       String?                        // "portrait" | "landscape" | "square"
  category    String?                        // "portrait", "location", "product", "logo", etc.
  articleId   String?   @map("article_id")   // Associated Kempopedia article
  article     Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  kyDate      DateTime? @map("ky_date")      // When "taken" in Kempo world
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  subjects    ImageSubject[]

  @@map("image")
}

model ImageSubject {
  id        String   @id @default(cuid())
  imageId   String   @map("image_id")
  image     Image    @relation(fields: [imageId], references: [id], onDelete: Cascade)
  itemId    String   @map("item_id")    // ID of the person, place, etc.
  itemType  String   @map("item_type")  // "person", "place", etc.
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([imageId, itemId, itemType])
  @@index([itemId, itemType])
  @@map("image_subjects")
}

// ============ VIDEO METADATA ============

model Genre {
  id        String   @id @default(cuid())
  name      String   @unique              // "Western", "Film-Noir", etc.
  slug      String   @unique              // "western", "film-noir", etc.
  createdAt DateTime @default(now()) @map("created_at")

  videos    VideoGenre[]
  series    SeriesGenre[]

  @@map("genres")
}

model VideoGenre {
  id        String   @id @default(cuid())
  videoId   String   @map("video_id")
  video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)
  genreId   String   @map("genre_id")
  genre     Genre    @relation(fields: [genreId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([videoId, genreId])
  @@index([videoId])
  @@index([genreId])
  @@map("video_genres")
}

model VideoElement {
  id        String    @id @default(cuid())
  videoId   String    @map("video_id")
  video     Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)
  personId  String    @map("person_id")
  person    Person    @relation(fields: [personId], references: [id], onDelete: Cascade)
  role      VideoRole                      // actor, director, writer, producer
  credit    String?                        // e.g., "as Clay Marshall"
  createdAt DateTime  @default(now()) @map("created_at")

  @@unique([videoId, personId, role])
  @@index([videoId])
  @@index([personId])
  @@map("video_elements")
}

model MovieMetadata {
  id          String        @id @default(cuid())
  videoId     String        @unique @map("video_id")
  video       Video         @relation(fields: [videoId], references: [id], onDelete: Cascade)
  studioId    String?       @map("studio_id")
  studio      Organization? @relation(fields: [studioId], references: [id], onDelete: SetNull)
  releaseYear Int?          @map("release_year")
  runtime     Int?                          // minutes
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  @@map("movie_metadata")
}

model Series {
  id          String        @id @default(cuid())
  title       String
  networkId   String?       @map("network_id")
  network     Organization? @relation(fields: [networkId], references: [id], onDelete: SetNull)
  startYear   Int?          @map("start_year")
  endYear     Int?          @map("end_year")
  description String?       @db.Text
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  genres      SeriesGenre[]
  episodes    TvEpisodeMetadata[]
  trailers    TrailerMetadata[]

  @@map("series")
}

model SeriesGenre {
  id        String   @id @default(cuid())
  seriesId  String   @map("series_id")
  series    Series   @relation(fields: [seriesId], references: [id], onDelete: Cascade)
  genreId   String   @map("genre_id")
  genre     Genre    @relation(fields: [genreId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([seriesId, genreId])
  @@index([seriesId])
  @@index([genreId])
  @@map("series_genres")
}

model TvEpisodeMetadata {
  id           String   @id @default(cuid())
  videoId      String   @unique @map("video_id")
  video        Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)
  seriesId     String   @map("series_id")
  series       Series   @relation(fields: [seriesId], references: [id], onDelete: Cascade)
  seasonNum    Int      @map("season_num")
  episodeNum   Int      @map("episode_num")
  episodeTitle String   @map("episode_title")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@index([seriesId])
  @@index([seriesId, seasonNum])
  @@map("tv_episode_metadata")
}

// --- Lookup Tables ---

model TrailerType {
  id        String   @id @default(cuid())
  name      String   @unique              // "Teaser", "Theatrical", etc.
  slug      String   @unique              // "teaser", "theatrical", etc.
  createdAt DateTime @default(now()) @map("created_at")

  trailers  TrailerMetadata[]

  @@map("trailer_types")
}

model AdType {
  id        String   @id @default(cuid())
  name      String   @unique              // "TV Spot", "Online Ad", etc.
  slug      String   @unique              // "tv-spot", "online-ad", etc.
  createdAt DateTime @default(now()) @map("created_at")

  commercials CommercialMetadata[]

  @@map("ad_types")
}

model ContentType {
  id        String   @id @default(cuid())
  name      String   @unique              // "Vlog", "Skit", etc.
  slug      String   @unique              // "vlog", "skit", etc.
  createdAt DateTime @default(now()) @map("created_at")

  onlineVideos OnlineMetadata[]

  @@map("content_types")
}

// --- Type-Specific Metadata ---

model TrailerMetadata {
  id            String       @id @default(cuid())
  videoId       String       @unique @map("video_id")
  video         Video        @relation(fields: [videoId], references: [id], onDelete: Cascade)
  forMovieId    String?      @map("for_movie_id")
  forMovie      Video?       @relation("TrailerForMovie", fields: [forMovieId], references: [id], onDelete: SetNull)
  forSeriesId   String?      @map("for_series_id")
  forSeries     Series?      @relation(fields: [forSeriesId], references: [id], onDelete: SetNull)
  trailerTypeId String       @map("trailer_type_id")
  trailerType   TrailerType  @relation(fields: [trailerTypeId], references: [id], onDelete: Restrict)
  trailerNumber Int?         @map("trailer_number")  // "Trailer 1", "Trailer 2", etc.
  createdAt     DateTime     @default(now()) @map("created_at")
  updatedAt     DateTime     @updatedAt @map("updated_at")

  @@index([forMovieId])
  @@index([forSeriesId])
  @@map("trailer_metadata")
}

model CommercialMetadata {
  id        String        @id @default(cuid())
  videoId   String        @unique @map("video_id")
  video     Video         @relation(fields: [videoId], references: [id], onDelete: Cascade)
  brandId   String?       @map("brand_id")
  brand     Brand?        @relation(fields: [brandId], references: [id], onDelete: SetNull)
  productId String?       @map("product_id")
  product   Product?      @relation(fields: [productId], references: [id], onDelete: SetNull)
  agencyId  String?       @map("agency_id")
  agency    Organization? @relation(fields: [agencyId], references: [id], onDelete: SetNull)
  adTypeId  String        @map("ad_type_id")
  adType    AdType        @relation(fields: [adTypeId], references: [id], onDelete: Restrict)
  campaign  String?                         // Campaign name
  airYear   Int?          @map("air_year")  // Year first aired
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  @@index([brandId])
  @@index([productId])
  @@map("commercial_metadata")
}

model OnlineMetadata {
  id            String      @id @default(cuid())
  videoId       String      @unique @map("video_id")
  video         Video       @relation(fields: [videoId], references: [id], onDelete: Cascade)
  creatorId     String?     @map("creator_id")
  creator       Person?     @relation(fields: [creatorId], references: [id], onDelete: SetNull)
  contentTypeId String      @map("content_type_id")
  contentType   ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Restrict)
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  @@index([creatorId])
  @@map("online_metadata")
}

// ============ VIDEO PLATFORMS ============

model KempoTubeChannel {
  id          String   @id @default(cuid())
  name        String   @unique              // "Kempo Clips", "Pacific Pictures"
  description String?  @db.Text            // About section
  avatarUrl   String?  @map("avatar_url")  // Channel icon
  bannerUrl   String?  @map("banner_url")  // YouTube-style banner
  websiteUrl  String?  @map("website_url") // Kempopedia link
  websiteName String?  @map("website_name")// Link display text
  createdAt   DateTime @default(now()) @map("created_at")

  videos    KempoTubeVideo[]

  @@map("kempotube_channels")
}

model FlipFlopAccount {
  id                String   @id @default(cuid())
  name              String   @unique              // "@kempoclips", "@pacificpics"
  displayName       String?  @map("display_name") // "Kempo Clips", "Pacific Pictures"
  bio               String?                       // Short description
  profilePictureUrl String?  @map("profile_picture_url")
  websiteUrl        String?  @map("website_url")  // Link to Kempopedia article
  websiteName       String?  @map("website_name") // Display text for the link
  personId          String?  @map("person_id")
  person            Person?  @relation(fields: [personId], references: [id], onDelete: SetNull)
  createdAt         DateTime @default(now()) @map("created_at")

  videos    FlipFlopVideo[]

  @@map("flipflop_accounts")
}

model TvChannel {
  id        String   @id @default(cuid())
  name      String   @unique              // "Kempo Broadcasting Company"
  callSign  String?  @map("call_sign")    // "KBC", "NBN"
  createdAt DateTime @default(now()) @map("created_at")

  broadcasts TvBroadcast[]

  @@map("tv_channels")
}

model KempoTubeVideo {
  id          String           @id @default(cuid())
  videoId     String           @unique @map("video_id")
  video       Video            @relation(fields: [videoId], references: [id], onDelete: Cascade)
  channelId   String           @map("channel_id")
  channel     KempoTubeChannel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  title       String?                          // Override video.name if needed
  publishedAt DateTime         @default(now()) @map("published_at")
  views       Int              @default(0)
  featured    Boolean          @default(false)
  createdAt   DateTime         @default(now()) @map("created_at")

  @@index([channelId])
  @@map("kempotube_videos")
}

model FlipFlopVideo {
  id          String         @id @default(cuid())
  videoId     String         @unique @map("video_id")
  video       Video          @relation(fields: [videoId], references: [id], onDelete: Cascade)
  accountId   String         @map("account_id")
  account     FlipFlopAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)
  publishedAt DateTime       @default(now()) @map("published_at")
  likes       Int            @default(0)
  featured    Boolean        @default(false)
  createdAt   DateTime       @default(now()) @map("created_at")

  @@index([accountId])
  @@map("flipflop_videos")
}

model TvBroadcast {
  id          String    @id @default(cuid())
  videoId     String    @map("video_id")
  video       Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)
  tvChannelId String    @map("tv_channel_id")
  tvChannel   TvChannel @relation(fields: [tvChannelId], references: [id], onDelete: Cascade)
  position    Int                              // Playlist order
  createdAt   DateTime  @default(now()) @map("created_at")

  @@index([tvChannelId])
  @@index([tvChannelId, position])
  @@map("tv_broadcasts")
}

// ============ KEMPONET DOMAINS ============

model Domain {
  id           String   @id @default(cuid())
  name         String   @unique // URL slug e.g., "kempotube", "giggle"
  displayName  String?  @map("display_name") // Human-readable e.g., "KempoTube", "Giggle"
  owner        String   // e.g., "GiggleNet"
  registeredAt DateTime @map("registered_at") // real-world registration date

  pages        Page[]

  @@map("domains")
}

model Page {
  id          String   @id @default(cuid())
  domainId    String   @map("domain_id")
  domain      Domain   @relation(fields: [domainId], references: [id], onDelete: Cascade)

  slug        String   // path within domain: "", "about", "services/cloud"
  title       String
  content     String   @db.Text // markdown content
  excerpt     String?  @db.Text // short description for search results
  searchable  Boolean  @default(true)
  template    String?  // "default", "corporate", "product", etc.
  metadata    Json?    // flexible additional data

  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([domainId, slug])
  @@index([domainId])
  @@map("pages")
}

// Search index for React app pages (search only, not used for routing)
model AppSearch {
  id          String    @id @default(cuid())
  path        String    @unique // e.g., "/kemponet/kemponet-browser"
  domain      String    // e.g., "kemponet-browser" for display in results
  title       String    // e.g., "KempoNet Browser"
  excerpt     String    @db.Text // short description for search results
  content     String    @db.Text // searchable content
  noSearch    Boolean   @default(false) @map("no_search") // exclude from search if true
  refreshedAt DateTime? @map("refreshed_at") // when AI last reviewed this page

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@map("app_search")
}

// ============ KEMPOPEDIA ARTICLES ============

model Article {
  id                 String     @id @default(cuid())
  title              String
  type               String     // "person", "place", "organization", "event", "culture", "product", "concept", "timeline", "company"
  subtype            String?    // "head-of-state", "city", etc.
  status             String     @default("published") // "published", "draft"

  // Temporal
  publishDate        DateTime?  @map("publish_date") // When article first appears in k.y.

  // Content
  content            String     @db.Text // markdown body
  infobox            Json?      // structured infobox data
  timelineEvents     Json?      @map("timeline_events") // array of {date, headline, description}
  mediaRefs          Json?      @map("media_refs") // array of audio/video references

  // Parallel universe tracking
  parallelSwitchover Json?      @map("parallel_switchover") // {real_world, wikipedia}

  // Metadata
  tags               String[]   // PostgreSQL array
  dates              String[]   // k.y. dates mentioned in the article
  linkCount          Int        @default(0) @map("link_count") // count of [[wikilinks]] in content

  // Timestamps
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")

  // Relations
  revisions          Revision[]
  person             Person?
  organization       Organization?
  brand              Brand?
  product            Product?
  nation             Nation?
  state              State?
  city               City?
  place              Place?
  album              Album?
  images             Image[]

  @@index([type])
  @@index([status])
  @@index([publishDate])
  @@map("articles")
}

model Revision {
  id             String   @id @default(cuid())
  articleId      String   @map("article_id")
  article        Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  // Snapshot of content at this point
  title          String
  content        String   @db.Text
  infobox        Json?
  timelineEvents Json?    @map("timeline_events")

  // Real-world tracking
  createdAt      DateTime @default(now()) @map("created_at")
  editSummary    String?  @map("edit_summary")
  editorId       String?  @map("editor_id")

  // In-universe tracking
  kempoDate      String?  @map("kempo_date") // "January 15, 1950 k.y."
  kempoEvent     String?  @map("kempo_event") // "Harold Kellman inaugurated"

  @@index([articleId, createdAt])
  @@map("revisions")
}

// ============ WORLD DATA: PEOPLE ============

model Person {
  id          String    @id @default(cuid())
  firstName   String    @map("first_name")
  middleName  String?   @map("middle_name")
  lastName    String    @map("last_name")
  nickname    String?                       // Informal name if different from firstName (e.g., "Frank" for "Francis")
  stageName   String?   @map("stage_name") // Professional/performer name (e.g., "Vivian Sterling", "Sting")
  gender      String    // "male" | "female"
  dateBorn    DateTime? @map("date_born")  // k.y. birth date
  dateDied    DateTime? @map("date_died")  // k.y. death date (null if alive)
  articleId   String?   @unique @map("article_id") // link to Kempopedia article
  article     Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  albums           Album[]          // Albums where this person is the primary artist
  videoElements    VideoElement[]   // Videos via role (actor, director, writer, producer)
  onlineVideos     OnlineMetadata[] // Online videos created by this person
  flipFlopAccounts FlipFlopAccount[] // FlipFlop accounts owned by this person
  events           EventPerson[]    // Events this person is linked to

  @@map("people")
}

model Organization {
  id            String    @id @default(cuid())
  name          String                           // "Pacific Pictures", "National Party"
  abbreviation  String?                          // "UBC", "NAMR"
  orgType       String    @map("org_type")       // "company", "political-party", "university", etc.
  dateFounded   DateTime? @map("date_founded")   // k.y. founding date
  dateDissolved DateTime? @map("date_dissolved") // k.y. dissolution date (null if active)
  articleId     String?   @unique @map("article_id")
  article       Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  brands        Brand[]
  albums        Album[]              // Albums released by this label
  movies        MovieMetadata[]      // Movies produced by this studio
  seriesNetwork Series[]             // TV series aired on this network
  commercials   CommercialMetadata[] // Commercials made by this agency

  @@map("organizations")
}

model Inspiration {
  id           String   @id @default(cuid())
  subjectId    String   @map("subject_id")    // ID of person or organization
  subjectType  String   @map("subject_type")  // "person" or "organization"
  inspiration  String                         // e.g., "Frank Sinatra"
  wikipediaUrl String?  @map("wikipedia_url") // optional Wikipedia link
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([subjectId, subjectType])
  @@map("inspirations")
}

// ============ WORLD DATA: BRANDS & PRODUCTS ============

model Brand {
  id              String        @id @default(cuid())
  name            String                              // "Monarch", "Sterling", "Regal"
  organizationId  String?       @map("organization_id")
  organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  dateFounded     DateTime?     @map("date_founded")  // k.y. founding date
  dateDiscontinued DateTime?    @map("date_discontinued") // k.y. discontinuation date (null if active)
  articleId       String?       @unique @map("article_id")
  article         Article?      @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  products    Product[]
  commercials CommercialMetadata[] // Commercials featuring this brand

  @@map("brands")
}

model Product {
  id              String    @id @default(cuid())
  name            String                              // "Monarch Imperial", "Continental Courier"
  productType     String    @map("product_type")      // "vehicle", "beverage", "tobacco", "publication", etc.
  brandId         String?   @map("brand_id")
  brand           Brand?    @relation(fields: [brandId], references: [id], onDelete: SetNull)
  dateIntroduced  DateTime? @map("date_introduced")   // k.y. launch date
  dateDiscontinued DateTime? @map("date_discontinued") // k.y. discontinuation date (null if active)
  articleId       String?   @unique @map("article_id")
  article         Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  commercials CommercialMetadata[] // Commercials featuring this product

  @@map("products")
}

// ============ WORLD DATA: LOCATIONS ============

model Nation {
  id            String    @id @default(cuid())
  name          String                           // "United States", "United Kingdom"
  shortCode     String?   @map("short_code")     // "US", "UK" (for flags, abbreviations)
  dateFounded   DateTime? @map("date_founded")   // k.y. founding/independence date
  dateDissolved DateTime? @map("date_dissolved") // for historical nations (null if active)
  lat           Float?                           // latitude (center point)
  long          Float?                           // longitude (center point)
  articleId     String?   @unique @map("article_id")
  article       Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  states        State[]

  @@map("nations")
}

model State {
  id            String    @id @default(cuid())
  name          String                           // "California", "New York"
  abbreviation  String?                          // "CA", "NY"
  stateType     String    @map("state_type")     // "state", "province", "territory", "region"
  nationId      String    @map("nation_id")
  nation        Nation    @relation(fields: [nationId], references: [id], onDelete: Cascade)
  dateFounded   DateTime? @map("date_founded")   // k.y. date established/admitted
  dateDisbanded DateTime? @map("date_disbanded") // k.y. date dissolved (null if active)
  lat           Float?                           // latitude (center point)
  long          Float?                           // longitude (center point)
  articleId     String?   @unique @map("article_id")
  article       Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  cities        City[]

  @@map("states")
}

model City {
  id            String    @id @default(cuid())
  name          String                           // "Los Angeles", "Havana Springs"
  cityType      String    @map("city_type")      // "city", "town", "village"
  stateId       String    @map("state_id")
  state         State     @relation(fields: [stateId], references: [id], onDelete: Cascade)
  dateFounded   DateTime? @map("date_founded")   // k.y. founding/incorporation date
  dateDisbanded DateTime? @map("date_disbanded") // k.y. date dissolved (null if active)
  lat           Float?                           // latitude
  long          Float?                           // longitude
  articleId     String?   @unique @map("article_id")
  article       Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  places        Place[]

  @@map("cities")
}

model Place {
  id            String    @id @default(cuid())
  name          String                           // "Little Italy", "The Oasis Casino"
  placeType     String    @map("place_type")     // "neighborhood", "building", "landmark", "casino", "studio", "park", "restaurant"
  cityId        String    @map("city_id")
  city          City      @relation(fields: [cityId], references: [id], onDelete: Cascade)
  parentPlaceId String?   @map("parent_place_id") // FK to self for nesting (e.g., casino in neighborhood)
  parentPlace   Place?    @relation("PlaceHierarchy", fields: [parentPlaceId], references: [id], onDelete: SetNull)
  childPlaces   Place[]   @relation("PlaceHierarchy")
  address       String?                          // "742 Sunset Boulevard"
  dateOpened    DateTime? @map("date_opened")    // k.y. opening/establishment date
  dateClosed    DateTime? @map("date_closed")    // k.y. closure date (null if active)
  lat           Float?                           // latitude
  long          Float?                           // longitude
  articleId     String?   @unique @map("article_id")
  article       Article?  @relation(fields: [articleId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("places")
}

// ============ PROJECT HISTORY ============

model ProjectHistory {
  id        String   @id @default(cuid())
  content   String   @db.Text // the milestone entry text
  createdAt DateTime @default(now()) @map("created_at")

  @@map("project_history")
}

// ============ SITE SETTINGS ============

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

// ============ EVENTS SYSTEM ============

model Event {
  id            String    @id @default(cuid())
  title         String
  description   String?   @db.Text
  kyDateBegin   DateTime  @map("ky_date_begin")
  kyDateEnd     DateTime? @map("ky_date_end")     // null = point event
  eventType     String    @map("event_type")      // birth, death, war, release, etc.
  significance  Int       @default(5)             // 1-10 for newspaper filtering
  parentId      String?   @map("parent_id")
  parent        Event?    @relation("EventHierarchy", fields: [parentId], references: [id])
  children      Event[]   @relation("EventHierarchy")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  relationsFrom EventRelation[] @relation("EventFrom")
  relationsTo   EventRelation[] @relation("EventTo")
  people        EventPerson[]
  locations     EventLocation[]
  media         EventMedia[]

  @@index([kyDateBegin])
  @@index([kyDateEnd])
  @@index([eventType])
  @@index([parentId])
  @@map("events")
}

model EventRelation {
  id              String   @id @default(cuid())
  eventId         String   @map("event_id")
  event           Event    @relation("EventFrom", fields: [eventId], references: [id], onDelete: Cascade)
  relatedEventId  String   @map("related_event_id")
  relatedEvent    Event    @relation("EventTo", fields: [relatedEventId], references: [id], onDelete: Cascade)
  relationType    String   @map("relation_type")  // part_of, caused_by, led_to, concurrent_with, related_to
  createdAt       DateTime @default(now()) @map("created_at")

  @@unique([eventId, relatedEventId, relationType])
  @@index([relatedEventId])
  @@map("event_relations")
}

model EventPerson {
  id        String   @id @default(cuid())
  eventId   String   @map("event_id")
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  personId  String   @map("person_id")
  person    Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  role      String?  // subject, participant, witness, performer, victim, perpetrator
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([eventId, personId])
  @@index([personId])
  @@map("event_people")
}

model EventLocation {
  id           String   @id @default(cuid())
  eventId      String   @map("event_id")
  event        Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  locationType String   @map("location_type")  // nation, state, city, place
  locationId   String   @map("location_id")
  role         String?  // occurred_at, originated_from, spread_to, destination
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([eventId, locationId, locationType])
  @@index([locationId, locationType])
  @@map("event_locations")
}

model EventMedia {
  id           String   @id @default(cuid())
  eventId      String   @map("event_id")
  event        Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  mediaType    String   @map("media_type")     // article, audio, video, image, album
  mediaId      String   @map("media_id")
  relationType String   @map("relation_type")  // depicts, released_during, mentioned_in, soundtrack
  createdAt    DateTime @default(now()) @map("created_at")

  @@unique([eventId, mediaId, mediaType])
  @@index([mediaId, mediaType])
  @@map("event_media")
}
